<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <title>A-Frame Optokinetik - Fehlerbehebte Version</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>
  <body>
    <!-- A-Frame Szene -->
    <a-scene>
      <!-- Kamera und Bewegung -->
      <a-entity
        id="cameraRig"
        position="0 1.6 0"
        wasd-controls="acceleration: 50"
        look-controls="pointerLockEnabled: true"
      >
        <a-camera audio-listener></a-camera>
      </a-entity>

      <!-- Schwarzer Hintergrund -->
      <a-sky color="#000000"></a-sky>

      <!-- Kugel mit Punkten -->
      <a-entity id="points-entity" optimized-points></a-entity>

      <!-- Sound Asset -->
      <a-assets>
        <!-- Audiodatei im Hauptverzeichnis -->
        <audio id="hum-sound" src="hum-sound.mp3"></audio>
      </a-assets>

      <!-- Menü mit Buttons -->
      <a-entity id="menu" position="0 1.5 -2">
        <!-- Buttons zur Änderung der Rotationsachse -->
        <a-entity id="axisButtons" position="0 0 0">
          <a-entity
            id="xButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: red"
            position="-1 0 0"
            text="value: X; align: center; width: 4; color: white"
            class="clickable"
          ></a-entity>
          <a-entity
            id="yButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: green"
            position="0 0 0"
            text="value: Y; align: center; width: 4; color: white"
            class="clickable"
          ></a-entity>
          <a-entity
            id="zButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: blue"
            position="1 0 0"
            text="value: Z; align: center; width: 4; color: white"
            class="clickable"
          ></a-entity>
        </a-entity>

        <!-- Buttons zur Geschwindigkeitsanpassung -->
        <a-entity id="speedButtons" position="0 -0.7 0">
          <a-entity
            id="speedUpButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: yellow"
            position="-0.5 0 0"
            text="value: +; align: center; width: 4; color: black"
            class="clickable"
          ></a-entity>
          <a-entity
            id="speedDownButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: orange"
            position="0.5 0 0"
            text="value: -; align: center; width: 4; color: black"
            class="clickable"
          ></a-entity>
        </a-entity>

        <!-- Buttons zur Anpassung der Skalierung -->
        <a-entity id="scaleButtons" position="0 -1.4 0">
          <a-entity
            id="scaleUpButton"
            geometry="primitive: plane; width: 1.0; height: 0.5"
            material="color: cyan"
            position="-0.7 0 0"
            text="value: + Skalierung; align: center; width: 6; color: black"
            class="clickable"
          ></a-entity>
          <a-entity
            id="scaleDownButton"
            geometry="primitive: plane; width: 1.0; height: 0.5"
            material="color: magenta"
            position="0.7 0 0"
            text="value: - Skalierung; align: center; width: 6; color: black"
            class="clickable"
          ></a-entity>
        </a-entity>

        <!-- Buttons zur Anpassung der Punktanzahl -->
        <a-entity id="pointCountButtons" position="0 -2.1 0">
          <a-entity
            id="pointsIncreaseButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: green"
            position="-0.5 0 0"
            text="value: + Punkte; align: center; width: 4; color: black"
            class="clickable"
          ></a-entity>
          <a-entity
            id="pointsDecreaseButton"
            geometry="primitive: plane; width: 0.5; height: 0.5"
            material="color: red"
            position="0.5 0 0"
            text="value: - Punkte; align: center; width: 4; color: black"
            class="clickable"
          ></a-entity>
        </a-entity>

        <!-- Button zum Ein-/Ausschalten des Sounds -->
        <a-entity
          id="soundToggleButton"
          geometry="primitive: plane; width: 1; height: 0.5"
          material="color: purple"
          position="0 -2.8 0"
          text="value: Sound An/Aus; align: center; width: 4; color: white"
          class="clickable"
        ></a-entity>
      </a-entity>

      <!-- Debugging Textanzeige -->
      <a-entity
        id="debugText"
        position="0 2 -2"
        text="value: Warten auf Eingabe...; color: yellow; width: 8;"
      ></a-entity>

      <!-- Controller für Interaktionen -->
      <a-entity laser-controls="hand: right" id="rightController"></a-entity>

      <!-- Script -->
      <script>
        AFRAME.registerComponent('optimized-points', {
          // ... (Unveränderte Komponentenfunktionalität)
          // Der restliche Code bleibt unverändert
        });

        // Event Listener für die Achsen-Buttons
        document.getElementById('xButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].setRotationAxis(new THREE.Vector3(1, 0, 0));
        });

        document.getElementById('yButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].setRotationAxis(new THREE.Vector3(0, 1, 0));
        });

        document.getElementById('zButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].setRotationAxis(new THREE.Vector3(0, 0, 1));
        });

        // Event Listener für die Geschwindigkeits-Buttons
        document.getElementById('speedUpButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustSpeed(0.2);
        });

        document.getElementById('speedDownButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustSpeed(-0.2);
        });

        // Event Listener für die Skalierungs-Buttons
        document.getElementById('scaleUpButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustScale(0.2);
        });

        document.getElementById('scaleDownButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustScale(-0.2);
        });

        // Event Listener für die Punktanzahl-Buttons
        document.getElementById('pointsIncreaseButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustPointCount(500);
        });

        document.getElementById('pointsDecreaseButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustPointCount(-500);
        });

        // Event Listener für den Sound-Button
        document.getElementById('soundToggleButton').addEventListener('click', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].toggleSound();
        });

        // Event Listener für den Trigger des Controllers
        const rightController = document.getElementById('rightController');

        rightController.addEventListener('triggerdown', function (evt) {
          // Überprüfen, ob der Controller auf ein interaktives Element zeigt
          const intersectedEl = evt.detail.intersectedEl;
          if (!intersectedEl) {
            // Keine interaktiven Elemente anvisiert, Animation umschalten
            const pointsEntity = document.getElementById('points-entity');
            pointsEntity.components['optimized-points'].toggleAnimation();
          }
        });

        // Event Listener für die A- und B-Tasten des rechten Controllers
        rightController.addEventListener('abuttondown', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustSpeed(0.2);
        });

        rightController.addEventListener('bbuttondown', function () {
          const pointsEntity = document.getElementById('points-entity');
          pointsEntity.components['optimized-points'].adjustSpeed(-0.2);
        });
      </script>
    </a-scene>
  </body>
</html>
