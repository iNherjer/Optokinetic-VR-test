<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <title>A-Frame Optokinetik - Punkte im Raster</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>
  <body>
    <!-- A-Frame Szene -->
    <a-scene>
      <!-- Kamera und Bewegung -->
      <a-entity
        id="cameraRig"
        position="0 1.6 0"
        wasd-controls="acceleration: 50"
        look-controls="pointerLockEnabled: true"
      >
        <a-camera></a-camera>
      </a-entity>

      <!-- Lichtquelle hinzufügen -->
      <a-entity light="type: ambient; color: #FFFFFF; intensity: 1"></a-entity>

      <!-- Schwarzer Hintergrund -->
      <a-sky color="#000000"></a-sky>

      <!-- Kugel mit Punkten mit rotating-points Komponente -->
      <a-entity id="points-group" rotating-points>
        <!-- Punkte werden durch die Komponente erstellt -->
      </a-entity>

      <!-- Debugging Textanzeige -->
      <a-entity
        id="debugText"
        position="0 2 -2"
        text="value: Warten auf Eingabe...; color: yellow; width: 4;"
      ></a-entity>

      <!-- VR-Button zum Starten/Stoppen der Animation -->
      <a-entity
        id="startButton"
        geometry="primitive: plane; width: 1; height: 0.5"
        material="color: green"
        position="0 1.5 -3"
        text="value: Start/Stop; align: center;"
        class="clickable"
      ></a-entity>

      <!-- Controller für Interaktionen -->
      <a-entity laser-controls="hand: right" id="rightController"></a-entity>

      <!-- Script für das Erstellen der Punkte und Animation -->
      <script>
        AFRAME.registerComponent('rotating-points', {
          schema: {},
          init: function () {
            const numberOfPoints = 1000; // Anzahl der Punkte
            this.radius = 20; // Radius der Kugel
            this.points = [];
            this.isAnimating = false;
            this.animationSpeed = 0.002; // Rotationsgeschwindigkeit
            this.createPoints(numberOfPoints, this.radius);
          },
          createPoints: function (numberOfPoints, radius) {
            const steps = Math.floor(Math.sqrt(numberOfPoints));
            for (let i = 0; i < steps; i++) {
              const theta = (i / steps) * Math.PI * 2;
              for (let j = 0; j < steps; j++) {
                const phi = (j / steps) * Math.PI;
                const point = document.createElement('a-sphere');
                point.setAttribute('radius', 0.1);
                point.setAttribute('color', '#FFFFFF');
                point.setAttribute('material', 'shader: flat; color: #FFFFFF'); // Flat Shader verwenden
                const x = radius * Math.sin(phi) * Math.cos(theta);
                const y = radius * Math.cos(phi);
                const z = radius * Math.sin(phi) * Math.sin(theta);
                point.setAttribute('position', { x: x, y: y, z: z });
                // Speichere theta und phi als Attribute
                point.setAttribute('data-theta', theta);
                point.setAttribute('data-phi', phi);
                this.el.appendChild(point);
                this.points.push(point);
              }
            }
            console.log('Punkte erstellt.');
          },
          tick: function (time, timeDelta) {
            if (!this.isAnimating) return;
            this.points.forEach((point) => {
              let theta = parseFloat(point.getAttribute('data-theta'));
              theta += this.animationSpeed;
              point.setAttribute('data-theta', theta);
              const phi = parseFloat(point.getAttribute('data-phi'));
              const radius = this.radius;
              const x = radius * Math.sin(phi) * Math.cos(theta);
              const y = radius * Math.cos(phi);
              const z = radius * Math.sin(phi) * Math.sin(theta);
              point.setAttribute('position', { x: x, y: y, z: z });
            });
          },
          toggleAnimation: function () {
            this.isAnimating = !this.isAnimating;
            const debugText = document.getElementById('debugText');
            debugText.setAttribute(
              'text',
              `value: Animation ${
                this.isAnimating ? 'gestartet' : 'gestoppt'
              }; color: ${this.isAnimating ? 'green' : 'red'}; width: 4`
            );
            console.log(`Animation ${this.isAnimating ? 'gestartet' : 'gestoppt'}`);
          },
        });

        // Event Listener für den VR-Button zum Starten/Stoppen
        document.getElementById('startButton').addEventListener('click', function () {
          const pointsGroup = document.getElementById('points-group');
          pointsGroup.components['rotating-points'].toggleAnimation();
          const debugText = document.getElementById('debugText');
          debugText.setAttribute('text', `value: VR-Button gedrückt; color: yellow; width: 4`);
          console.log('VR-Button gedrückt.');
        });

        // WebXR Eingabesystem für Controller-Ereignisse
        const rightController = document.getElementById('rightController');
        rightController.addEventListener('triggerdown', function () {
          const pointsGroup = document.getElementById('points-group');
          pointsGroup.components['rotating-points'].toggleAnimation();
          const debugText = document.getElementById('debugText');
          debugText.setAttribute('text', `value: Trigger gedrückt; color: yellow; width: 4`);
          console.log('Trigger gedrückt.');
        });

        rightController.addEventListener('triggerup', function () {
          const debugText = document.getElementById('debugText');
          debugText.setAttribute('text', `value: Trigger losgelassen; color: yellow; width: 4`);
          console.log('Trigger losgelassen.');
        });
      </script>
    </a-scene>
  </body>
</html>
