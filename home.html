<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>A-Frame Optokinetik - Punkte im Raster</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  </head>
  <body>
    <!-- A-Frame Szene -->
    <a-scene>
      <!-- Kamera und Bewegung -->
      <a-entity id="cameraRig" position="0 1.6 0" wasd-controls="acceleration: 50" look-controls="pointerLockEnabled: true">
        <a-camera></a-camera>
      </a-entity>

      <!-- Schwarzer Hintergrund -->
      <a-sky color="#000000"></a-sky>

      <!-- Kugel mit Punkten -->
      <a-entity id="points-group">
        <!-- Punkte werden durch JavaScript hinzugefügt -->
      </a-entity>

      <!-- Script für das Erstellen der Punkte und Animation -->
      <script>
        const numberOfPoints = 1000;  // Anzahl der Punkte
        const radius = 20;  // Radius der Kugel
        const pointsGroup = document.getElementById('points-group');
        let isAnimating = false;  // Flag, um Animation zu steuern

        // Punkte im Raster erzeugen
        function createPoints() {
          const steps = Math.floor(Math.sqrt(numberOfPoints));  // Für ein gleichmäßiges Raster
          
          for (let i = 0; i < steps; i++) {
            const theta = (i / steps) * Math.PI * 2;  // Winkel um die Y-Achse

            for (let j = 0; j < steps; j++) {
              const phi = (j / steps) * Math.PI;  // Winkel um die X-Achse

              const point = document.createElement('a-sphere');
              point.setAttribute('radius', 0.1);  // Größe der Punkte
              point.setAttribute('color', '#FFFFFF');  // Farbe

              const x = radius * Math.sin(phi) * Math.cos(theta);
              const y = radius * Math.cos(phi);
              const z = radius * Math.sin(phi) * Math.sin(theta);
              
              point.setAttribute('position', `${x} ${y} ${z}`);
              point.setAttribute('theta', theta);
              point.setAttribute('phi', phi);

              pointsGroup.appendChild(point);
            }
          }
        }

        // Punkte animieren, indem sie um den Spieler rotieren
        function rotatePoints() {
          if (!isAnimating) return;  // Stoppe Animation, wenn Flag auf false steht
          const points = document.querySelectorAll('a-sphere');
          
          points.forEach((point) => {
            let theta = parseFloat(point.getAttribute('theta'));
            theta += 0.002;  // Rotationsgeschwindigkeit
            point.setAttribute('theta', theta);
            
            const phi = parseFloat(point.getAttribute('phi'));
            const x = radius * Math.sin(phi) * Math.cos(theta);
            const y = radius * Math.cos(phi);
            const z = radius * Math.sin(phi) * Math.sin(theta);
            
            point.setAttribute('position', `${x} ${y} ${z}`);
          });

          requestAnimationFrame(rotatePoints);  // Animation in Endlosschleife
        }

        // Punkte erstellen
        createPoints();

        // Gamepad-Steuerung für die Animation
        function checkGamepad() {
          const gamepads = navigator.getGamepads();
          if (gamepads[0]) {
            const buttonPressed = gamepads[0].buttons[0].pressed;  // Taste A des Controllers
            if (buttonPressed) {
              isAnimating = !isAnimating;  // Toggle der Animation
              if (isAnimating) rotatePoints();  // Starte Animation
            }
          }
          requestAnimationFrame(checkGamepad);  // Prüfe ständig auf Gamepad-Eingaben
        }

        checkGamepad();  // Starte Gamepad-Überprüfung
      </script>
    </a-scene>
  </body>
</html>
